"use strict";(self.webpackChunkulbi=self.webpackChunkulbi||[]).push([[863],{8017:(e,t,r)=>{r.r(t),r.d(t,{default:()=>re});var n=r(6540),a=r(423);const i={commentTitle:"Mpybt17C",recommendations:"D7bMkqrz"};var s=r(2389),c=r(8623),o=r(4768),l=r(2828),d=r(467),u=r(4756),m=r.n(u),f=r(5307),x=(0,f.zD)("articleDetails/fetchCommentsByArticalId",function(){var e=(0,d.A)(m().mark((function e(t,r){var n,a,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.extra,a=r.rejectWithValue,t){e.next=3;break}return e.abrupt("return",a("error"));case 3:return e.prev=3,e.next=6,n.api.get("/comments",{params:{articleId:t}});case 6:if((i=e.sent).data){e.next=9;break}throw new Error;case 9:return console.log(i.data),e.abrupt("return",i.data);case 13:return e.prev=13,e.t0=e.catch(3),e.abrupt("return",a("error"));case 16:case"end":return e.stop()}}),e,null,[[3,13]])})));return function(t,r){return e.apply(this,arguments)}}()),p=r(572),v=r(4644),h=(0,f.zD)("articleDetailsPage/fetchArticleRecommendations",function(){var e=(0,d.A)(m().mark((function e(t,r){var n,a,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.extra,a=r.rejectWithValue,e.prev=1,e.next=4,n.api.get("/articles",{params:{_limit:4}});case 4:if((i=e.sent).data){e.next=7;break}throw new Error;case 7:return console.log(i.data),e.abrupt("return",i.data);case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",a("error"));case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,r){return e.apply(this,arguments)}}()),g=(0,f.pU)({selectId:function(e){return e.id}}),j=(g.getSelectors((function(e){var t;return(null===(t=e.articleDetailsPage)||void 0===t?void 0:t.recommendations)||g.getInitialState()})),(0,f.Z0)({name:"articleDetailsCommentsSlice",initialState:g.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:function(e){e.addCase(h.pending,(function(e){e.error=void 0,e.isLoading=!0})).addCase(h.fulfilled,(function(e,t){e.isLoading=!1,g.setAll(e,t.payload)})).addCase(h.rejected,(function(e,t){e.isLoading=!1,e.error=t.payload}))}}).reducer),C=(0,f.pU)({selectId:function(e){return e.id}}),b=C.getSelectors((function(e){var t;return(null===(t=e.articleDetailsPage)||void 0===t?void 0:t.comments)||C.getInitialState()})),N=(0,f.Z0)({name:"articleDetailsCommentsSlice",initialState:C.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:function(e){e.addCase(x.pending,(function(e){e.error=void 0,e.isLoading=!0})).addCase(x.fulfilled,(function(e,t){e.isLoading=!1,C.setAll(e,t.payload)})).addCase(x.rejected,(function(e,t){e.isLoading=!1,e.error=t.payload}))}}).reducer,L=(0,v.HY)({recommendations:j,comments:N});const k={};var w=r(5102),y=r(7767),D=r(9100),A=r(1468),E=r(8363),I=r(5508),S=r(2636),z=(0,I.Mz)(E.sY,S.ed,(function(e,t){return!(!e||!t)&&e.user.id===t.id})),R=r(8918),T=r(4848),Y=function(e){var t=e.className,r=(0,s.Bd)().t,i=(0,y.Zp)(),c=(0,A.d4)(z),o=(0,A.d4)(E.sY),l=(0,n.useCallback)((function(){i(D.RU.articles)}),[i]),d=(0,n.useCallback)((function(){i("".concat(D.RU.article_details).concat(null==o?void 0:o.id,"/edit"))}),[null==o?void 0:o.id,i]);return o?(0,T.jsxs)(R.z,{max:!0,justify:"between",className:(0,a.x)(k.ArticleDetailPageHeader,{},[t]),children:[(0,T.jsx)(w.$n,{onClick:l,theme:w.oy.OUTLINE,children:r("Назад")}),c&&(0,T.jsx)(w.$n,{className:k.editBtn,onClick:d,theme:w.oy.OUTLINE,children:r("Редактировать")})]}):null};const B=(0,n.memo)(Y),U={};var P=r(3795),q=r(8251).q.injectEndpoints({endpoints:function(e){return{getArticlesRecommendationsList:e.query({query:function(e){return{url:"/articles",params:{_limit:e}}}})}}}).useGetArticlesRecommendationsListQuery,H=(0,n.memo)((function(e){var t=e.className,r=(0,s.Bd)().t,n=q(3),i=n.isLoading,c=n.data,o=n.error;return i||o||!c?null:(0,T.jsxs)(R.T,{gap:"8",className:(0,a.x)(U.ArticleRecommendationsList,{},[t]),children:[(0,T.jsx)(P.EY,{size:P.$C.L,className:U.commentTitle,title:r("Рекомендуем")}),(0,T.jsx)(E.R2,{target:"_blank",className:U.recommendations,articles:c,virtualized:!1})]})}));const _={};var M=(0,n.lazy)((function(){return new Promise((function(e){setTimeout((function(){e(r.e(112).then(r.bind(r,3112)))}),1500)}))}));const O={},V={CommentCard:"xIHByGcu",header:"dsH_3Oqu",username:"dw82WMzO",loading:"V0iZ1Un3"};var W=r(8807),Z=r(6451),$=r(582),G=function(e){var t,r,n,i=e.className,c=e.comment,o=e.isLoading;return(0,s.Bd)().t,o?(0,T.jsxs)("div",{className:(0,a.x)(V.CommentCard,{},[i,V.loading]),children:[(0,T.jsxs)("div",{className:V.header,children:[(0,T.jsx)(Z.E,{width:30,height:30,border:"50%"}),(0,T.jsx)(Z.E,{width:100,height:16,className:V.username})]}),(0,T.jsx)(Z.E,{className:V.text,width:"100%",height:50})]}):c?(0,T.jsxs)(R.T,{gap:"16",max:!0,className:(0,a.x)(V.CommentCard,{},[i]),children:[(0,T.jsxs)($.E,{to:"".concat(D.RU.profile).concat(c.user.id),className:V.header,children:[null!==(t=c.user)&&void 0!==t&&t.avatar?(0,T.jsx)(W.e,{size:30,src:null===(r=c.user)||void 0===r?void 0:r.avatar}):null,(0,T.jsx)(P.EY,{className:V.username,title:null===(n=c.user)||void 0===n?void 0:n.username})]}),(0,T.jsx)(P.EY,{className:V.text,text:null==c?void 0:c.text})]}):null},F=function(e){var t=e.className,r=e.isLoading,n=e.comments,i=(0,s.Bd)().t,c={};return r&&(R.T,(0,a.x)(O.CommentList,c,[t])),(0,T.jsx)(R.T,{gap:"16",className:(0,a.x)(O.CommentList,c,[t]),children:null!=n&&n.length?n.map((function(e,t){return(0,T.jsx)(G,{isLoading:r,className:O.comment,comment:e},t)})):(0,T.jsx)(P.EY,{title:i("Нет комментариев")})})},Q=function(e){var t;return null===(t=e.articleDetailsPage)||void 0===t?void 0:t.comments.isLoading},J=r(6849),K=(0,f.zD)("articleDetails/addCommentForArticle",function(){var e=(0,d.A)(m().mark((function e(t,r){var n,a,i,s,c,o,l;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.extra,a=r.dispatch,i=r.rejectWithValue,s=r.getState,c=(0,S.ed)(s()),o=(0,J.sY)(s()),c&&t&&o){e.next=5;break}return e.abrupt("return",i("no data"));case 5:return e.prev=5,e.next=8,n.api.post("/comments",{articleId:o.id,userId:c.id,text:t});case 8:if((l=e.sent).data){e.next=11;break}throw new Error;case 11:return a(x(o.id)),e.abrupt("return",l.data);case 15:return e.prev=15,e.t0=e.catch(5),e.abrupt("return",i("error"));case 18:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(t,r){return e.apply(this,arguments)}}()),X=(0,n.memo)((function(e){var t=e.className,r=e.id,i=(0,s.Bd)().t,c=(0,l.j)(),d=(0,A.d4)(b.selectAll),u=(0,A.d4)(Q);(0,o.b)((function(){c(x(r))}));var m=(0,n.useCallback)((function(e){c(K(e))}),[c]);return(0,T.jsxs)("div",{className:(0,a.x)(_.articleDetailsComments,{},[t]),children:[(0,T.jsx)(P.EY,{size:P.$C.L,className:_.commentTitle,title:i("Комментарии")}),(0,T.jsx)(n.Suspense,{fallback:"Идёт загрузка",children:(0,T.jsx)(M,{onSendComment:m})}),(0,T.jsx)(F,{isLoading:u,comments:d})]})})),ee={articleDetailsPage:L},te=function(e){var t=e.className,r=((0,s.Bd)().t,(0,y.g)().id),n=(0,l.j)();return(0,o.b)((function(){n(x(r))})),(0,T.jsx)(c.H,{reducers:ee,removeAfterUnmount:!0,children:(0,T.jsx)(p.Y,{className:(0,a.x)(i.ArticleDetailPage,{},[t]),children:(0,T.jsxs)(R.T,{gap:"16",max:!0,children:[(0,T.jsx)(B,{}),(0,T.jsx)(E.R0,{id:r}),(0,T.jsx)(H,{}),(0,T.jsx)(X,{id:r})]})})})};const re=(0,n.memo)(te)}}]);